from dynamsoft_barcode_reader_bundle import *
import os
if __name__ == '__main__':
    # 1. Initialize license.
    # You can request and extend a trial license from https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&utm_source=samples&package=python
    # The string 'DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTcGR6Vm05WDJrcEQ5YUoifQ==' here is a free public trial license. Note that network connection is required for this license to work.
    errorCode, errorMsg = LicenseManager.init_license("DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTcGR6Vm05WDJrcEQ5YUoifQ==")
    if errorCode != EnumErrorCode.EC_OK and errorCode != EnumErrorCode.EC_LICENSE_WARNING:
        print("License initialization failed: ErrorCode:", errorCode, ", ErrorString:", errorMsg)
    else:
        # 2. Create an instance of CaptureVisionRouter.
        cvr_instance = CaptureVisionRouter()

        # 3. Replace by your own image path.
        image_path = os.path.dirname(os.path.abspath(__file__)) + os.path.sep + "../images/GeneralBarcodes.png"

        # 4. Decode barcodes from an image file.
        result_array = cvr_instance.capture_multi_pages(image_path, EnumPresetTemplate.PT_READ_BARCODES)

        # 5. Output the barcode text.
        results = result_array.get_results()
        if results is None or len(results) == 0:
            print("No barcode detected.")
        else:
            for i, result in enumerate(results):
                page_number = i + 1
                tag = result.get_original_image_tag()
                if isinstance(tag, FileImageTag):
                    page_number = tag.get_page_number() + 1
                if result.get_error_code() == EnumErrorCode.EC_UNSUPPORTED_JSON_KEY_WARNING:
                    print("Warning:", result.get_error_code(), result.get_error_string())
                elif result.get_error_code() != EnumErrorCode.EC_OK:
                    print("Error:", result.get_error_code(), result.get_error_string())
                barcode_result = result.get_decoded_barcodes_result()
                if barcode_result is None or barcode_result.get_items() == 0:
                    print("Page-"+str(page_number), "No barcode detected.")
                else:
                    items = barcode_result.get_items()
                    print("Page-"+str(page_number), "Decoded", len(items), "barcodes.")
                    for index,item in enumerate(items):
                        print("Result", index+1)
                        print("Barcode Format:", item.get_format_string())
                        print("Barcode Text:", item.get_text())
                print()
    input("Press Enter to quit...")